import React, { useState, useRef } from 'react';
import { Copy, Check, RotateCcw, Undo, Bold, Italic, Underline } from 'lucide-react';

export default function LinkedInFormatter() {
  const [inputText, setInputText] = useState('');
  const [formatting, setFormatting] = useState({});
  const [copied, setCopied] = useState(false);
  const [history, setHistory] = useState([]);
  const inputRef = useRef(null);

  // Unicode character mappings
  const boldMap = {
    'A': 'ùêÄ', 'B': 'ùêÅ', 'C': 'ùêÇ', 'D': 'ùêÉ', 'E': 'ùêÑ', 'F': 'ùêÖ', 'G': 'ùêÜ', 'H': 'ùêá', 'I': 'ùêà', 'J': 'ùêâ',
    'K': 'ùêä', 'L': 'ùêã', 'M': 'ùêå', 'N': 'ùêç', 'O': 'ùêé', 'P': 'ùêè', 'Q': 'ùêê', 'R': 'ùêë', 'S': 'ùêí', 'T': 'ùêì',
    'U': 'ùêî', 'V': 'ùêï', 'W': 'ùêñ', 'X': 'ùêó', 'Y': 'ùêò', 'Z': 'ùêô',
    'a': 'ùêö', 'b': 'ùêõ', 'c': 'ùêú', 'd': 'ùêù', 'e': 'ùêû', 'f': 'ùêü', 'g': 'ùê†', 'h': 'ùê°', 'i': 'ùê¢', 'j': 'ùê£',
    'k': 'ùê§', 'l': 'ùê•', 'm': 'ùê¶', 'n': 'ùêß', 'o': 'ùê®', 'p': 'ùê©', 'q': 'ùê™', 'r': 'ùê´', 's': 'ùê¨', 't': 'ùê≠',
    'u': 'ùêÆ', 'v': 'ùêØ', 'w': 'ùê∞', 'x': 'ùê±', 'y': 'ùê≤', 'z': 'ùê≥',
    '0': 'ùüé', '1': 'ùüè', '2': 'ùüê', '3': 'ùüë', '4': 'ùüí', '5': 'ùüì', '6': 'ùüî', '7': 'ùüï', '8': 'ùüñ', '9': 'ùüó'
  };

  const italicMap = {
    'A': 'ùê¥', 'B': 'ùêµ', 'C': 'ùê∂', 'D': 'ùê∑', 'E': 'ùê∏', 'F': 'ùêπ', 'G': 'ùê∫', 'H': 'ùêª', 'I': 'ùêº', 'J': 'ùêΩ',
    'K': 'ùêæ', 'L': 'ùêø', 'M': 'ùëÄ', 'N': 'ùëÅ', 'O': 'ùëÇ', 'P': 'ùëÉ', 'Q': 'ùëÑ', 'R': 'ùëÖ', 'S': 'ùëÜ', 'T': 'ùëá',
    'U': 'ùëà', 'V': 'ùëâ', 'W': 'ùëä', 'X': 'ùëã', 'Y': 'ùëå', 'Z': 'ùëç',
    'a': 'ùëé', 'b': 'ùëè', 'c': 'ùëê', 'd': 'ùëë', 'e': 'ùëí', 'f': 'ùëì', 'g': 'ùëî', 'h': '‚Ñé', 'i': 'ùëñ', 'j': 'ùëó',
    'k': 'ùëò', 'l': 'ùëô', 'm': 'ùëö', 'n': 'ùëõ', 'o': 'ùëú', 'p': 'ùëù', 'q': 'ùëû', 'r': 'ùëü', 's': 'ùë†', 't': 'ùë°',
    'u': 'ùë¢', 'v': 'ùë£', 'w': 'ùë§', 'x': 'ùë•', 'y': 'ùë¶', 'z': 'ùëß'
  };

  const applyFormatting = (type) => {
    const textarea = inputRef.current;
    if (!textarea) return;

    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    
    if (start === end) return; // No selection

    // Save current state to history before making changes
    setHistory([...history, { text: inputText, formatting: { ...formatting } }]);

    const newFormatting = { ...formatting };
    
    // Toggle formatting for selected range
    for (let i = start; i < end; i++) {
      if (!newFormatting[i]) {
        newFormatting[i] = {};
      }
      newFormatting[i][type] = !newFormatting[i][type];
    }
    
    setFormatting(newFormatting);
  };

  const handleUndo = () => {
    if (history.length === 0) return;
    
    const lastState = history[history.length - 1];
    setInputText(lastState.text);
    setFormatting(lastState.formatting);
    setHistory(history.slice(0, -1));
  };

  const handleTextChange = (e) => {
    // Save to history when text changes
    if (inputText !== e.target.value) {
      setHistory([...history, { text: inputText, formatting: { ...formatting } }]);
    }
    setInputText(e.target.value);
    // Clear formatting for new characters beyond current length
    if (e.target.value.length < inputText.length) {
      const newFormatting = {};
      Object.keys(formatting).forEach(key => {
        if (parseInt(key) < e.target.value.length) {
          newFormatting[key] = formatting[key];
        }
      });
      setFormatting(newFormatting);
    }
  };

  const convertToUnicode = () => {
    let result = '';
    
    for (let i = 0; i < inputText.length; i++) {
      let char = inputText[i];
      const format = formatting[i] || {};
      
      // Apply bold
      if (format.bold && boldMap[char]) {
        char = boldMap[char];
      }
      
      // Apply italic
      if (format.italic && italicMap[char]) {
        char = italicMap[char];
      }
      
      result += char;
      
      // Apply underline (combining character)
      if (format.underline && char.trim()) {
        result += '\u0332'; // Combining low line
      }
    }
    
    return result;
  };

  const handleCopy = async () => {
    const output = convertToUnicode();
    await navigator.clipboard.writeText(output);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  const handleClear = () => {
    setInputText('');
    setFormatting({});
    setHistory([]);
  };

  const outputText = convertToUnicode();
  const charCount = inputText.length;

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-100 via-purple-50 to-pink-100 p-6">
      <div className="max-w-5xl mx-auto">
        {/* Header */}
        <div className="text-center mb-8">
          <h1 className="text-4xl font-bold text-gray-800 mb-3 tracking-tight">
            LinkedIn Text Formatter
          </h1>
          <p className="text-lg text-gray-600">
            Transform your text with bold, italic, and underline formatting for LinkedIn
          </p>
        </div>

        <div className="bg-white rounded-2xl shadow-xl p-8 border border-gray-100">
          
          {/* Input Section */}
          <div className="mb-8">
            <div className="flex items-center justify-between mb-3">
              <label className="text-lg font-bold text-gray-800">
                ‚úçÔ∏è Write Your Text
              </label>
              <div className="flex items-center gap-3">
                <span className="text-sm font-medium text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                  {charCount} characters
                </span>
              </div>
            </div>
            
            {/* Formatting Toolbar */}
            <div className="flex gap-2 mb-3 p-3 bg-gray-50 rounded-lg border border-gray-200">
              <button
                onClick={() => applyFormatting('bold')}
                className="flex items-center gap-2 px-4 py-2.5 bg-white border-2 border-gray-300 text-gray-700 rounded-lg hover:border-blue-500 hover:bg-blue-50 hover:text-blue-700 font-semibold transition-all shadow-sm"
                title="Bold (select text first)"
              >
                <Bold size={18} />
                Bold
              </button>
              <button
                onClick={() => applyFormatting('italic')}
                className="flex items-center gap-2 px-4 py-2.5 bg-white border-2 border-gray-300 text-gray-700 rounded-lg hover:border-blue-500 hover:bg-blue-50 hover:text-blue-700 italic transition-all shadow-sm"
                title="Italic (select text first)"
              >
                <Italic size={18} />
                Italic
              </button>
              <button
                onClick={() => applyFormatting('underline')}
                className="flex items-center gap-2 px-4 py-2.5 bg-white border-2 border-gray-300 text-gray-700 rounded-lg hover:border-blue-500 hover:bg-blue-50 hover:text-blue-700 transition-all shadow-sm"
                title="Underline (select text first)"
              >
                <Underline size={18} />
                Underline
              </button>
              
              <div className="flex-1"></div>
              
              <button
                onClick={handleUndo}
                disabled={history.length === 0}
                className="flex items-center gap-2 px-4 py-2.5 bg-white border-2 border-gray-300 text-gray-700 rounded-lg hover:border-purple-500 hover:bg-purple-50 hover:text-purple-700 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:border-gray-300 disabled:hover:bg-white disabled:hover:text-gray-700 transition-all shadow-sm"
                title="Undo last action"
              >
                <Undo size={18} />
                Undo
              </button>
              
              <button
                onClick={handleClear}
                className="flex items-center gap-2 px-4 py-2.5 bg-white border-2 border-red-300 text-red-600 rounded-lg hover:bg-red-50 hover:border-red-500 transition-all shadow-sm"
                title="Clear all"
              >
                <RotateCcw size={18} />
                Clear
              </button>
            </div>
            
            <textarea
              ref={inputRef}
              value={inputText}
              onChange={handleTextChange}
              className="w-full h-56 p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 focus:outline-none resize-none font-sans text-base leading-relaxed transition-all"
              placeholder="Start typing or paste your text here...

Select any text and use the formatting buttons above to style it!"
            />
          </div>

          {/* Output Section */}
          <div className="mb-6">
            <div className="flex items-center justify-between mb-3">
              <label className="text-lg font-bold text-gray-800">
                üìã LinkedIn-Ready Output
              </label>
              <button
                onClick={handleCopy}
                disabled={!outputText}
                className={`flex items-center gap-2 px-6 py-2.5 rounded-lg font-semibold transition-all shadow-lg ${
                  copied 
                    ? 'bg-green-500 text-white' 
                    : 'bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-40 disabled:cursor-not-allowed'
                }`}
              >
                {copied ? (
                  <>
                    <Check size={18} />
                    Copied to Clipboard!
                  </>
                ) : (
                  <>
                    <Copy size={18} />
                    Copy to Clipboard
                  </>
                )}
              </button>
            </div>
            
            <div className="w-full min-h-56 p-4 bg-gradient-to-br from-gray-50 to-gray-100 border-2 border-gray-300 rounded-xl font-sans text-base whitespace-pre-wrap break-words leading-relaxed">
              {outputText || (
                <span className="text-gray-400 italic">
                  Your formatted text will appear here. Copy and paste it directly into LinkedIn!
                </span>
              )}
            </div>
          </div>

          {/* Instructions */}
          <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 p-5 rounded-lg">
            <h3 className="font-bold text-gray-800 mb-2 flex items-center gap-2">
              <span className="text-xl">üí°</span> How to Use
            </h3>
            <ol className="text-sm text-gray-700 space-y-1 ml-6 list-decimal">
              <li>Type or paste your text in the input box above</li>
              <li>Select the text you want to format</li>
              <li>Click Bold, Italic, or Underline (you can combine multiple formats!)</li>
              <li>Copy the formatted output and paste it into LinkedIn</li>
              <li>Use Undo to reverse your last action, or Clear to start over</li>
            </ol>
          </div>
        </div>

        {/* Footer */}
        <div className="text-center mt-6 text-sm text-gray-600">
          <div className="mb-2">Built for productivity ‚Ä¢ No sign-up ‚Ä¢ No fees ‚Ä¢ Works offline</div>
          <div className="text-xs text-gray-500">Copyright ¬© Dr. Arka Sarkar 2026</div>
        </div>
      </div>
    </div>
  );
}
